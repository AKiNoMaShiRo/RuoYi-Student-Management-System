<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.info.mapper.ClassInfoMapper">

    <resultMap id="ClassInfoResult" type="ClassInfo">
        <id         property="classId"          column="class_id"/>
        <result     property="department"       column="department"/>
        <result     property="profession"       column="profession"/>
        <result     property="grade"            column="grade"/>
        <result     property="classNum"         column="class_num"/>
        <result     property="instructorId"     column="instructor_id"/>
        <result     property="instructorName"     column="instructor_name"/>
        <result     property="headmasterId"     column="headmaster_id"/>
        <result     property="headmasterName"     column="headmaster_name"/>
    </resultMap>

    <resultMap id="ProfessionTypeResult" type="String">
        <result     property="profession"       column="profession"/>
    </resultMap>

    <sql id="ClassInfoVo">
        select class_info.*, instructor_info.*, headmaster_info.*
        from class_info inner join instructor_info inner join headmaster_info
        on class_info.instructor_id = instructor_info.instructor_id and class_info.headmaster_id = headmaster_info.headmaster_id
    </sql>

    <select id="selectClassInfo" parameterType="ClassInfo" resultMap="ClassInfoResult">
        <include refid="ClassInfoVo"></include>
        <where>
            1=1
            <if test="classId != null and classId != 0">and class_info.class_id = #{classId}</if>
            <if test="profession != null and profession != ''">and class_info.profession = #{profession}</if>
            <if test="grade != null and grade != 0">and class_info.grade = #{grade}</if>
            <if test="instructorId != null and instructorId != ''">and class_info.instructor_id = #{instructorId}</if>
            <if test="instructorName != null and instructorName != ''">and instructor_info.instructor_name = #{instructorName}</if>
            <if test="headmasterId != null and headmasterId != ''">and headmaster_id = #{headmasterId} </if>
            <if test="headmasterName != null and headmasterName != ''">and headmaster_name = #{headmasterName} </if>
        </where>
    </select>

    <select id="selectProfessionType" resultMap="ProfessionTypeResult">
        select distinct class_info.profession from class_info
    </select>

    <insert id="insertClassInfo" parameterType="ClassInfo" useGeneratedKeys="true" keyProperty="classId">
        insert into class_info (
            department, profession, grade, class_num, instructor_id, headmaster_id
        ) values (
            #{department}, #{profession}, #{grade}, #{classNum}, #{instructorId}, #{headmasterId}
        )
    </insert>

    <update id="updateClassInfo" parameterType="Classinfo">
        update class_info
        <set>
            <if test="department != null and department != ''">department = #{department},</if>
            <if test="profession != null and profession != ''">profession = #{profession},</if>
            <if test="grade != null and grade != 0">grade = #{grade},</if>
            <if test="classNum != null and classNum != 0">class_num = #{classNum},</if>
            <if test="instructorId != null and instructorId != ''">instructor_id = #{instructorId},</if>
            <if test="headmasterId != null and headmasterId != ''">headmaster_id = #{headmasterId},</if>
        </set>
        where class_id = #{classId}
    </update>

    <delete id="deleteClassInfo" parameterType="Long">
        delete from class_info where class_id = #{classId}
    </delete>

</mapper>